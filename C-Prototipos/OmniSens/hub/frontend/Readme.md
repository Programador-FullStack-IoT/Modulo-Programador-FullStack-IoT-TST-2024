# PROYECTO OMNISENS
## Visualizacion en NODE-RED


### Requisitos previos:
- node-red-dashboard

### archivo para importar dashboard 

```json

[
    {
        "id": "4ba25265ccfd5bef",
        "type": "tab",
        "label": "Test Vista",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "50bdc914e921a9bc",
        "type": "mqtt in",
        "z": "4ba25265ccfd5bef",
        "name": "MQTT Input",
        "topic": "aqi/datos",
        "qos": "0",
        "datatype": "auto-detect",
        "broker": "mqtt_broker",
        "nl": false,
        "rap": false,
        "inputs": 0,
        "x": 170,
        "y": 120,
        "wires": [
            [
                "d3e07d6b64a66ba3"
            ]
        ]
    },
    {
        "id": "1d55eb76f69f6745",
        "type": "ui_gauge",
        "z": "4ba25265ccfd5bef",
        "name": "",
        "group": "d87413d0f61f55dc",
        "order": 3,
        "width": "4",
        "height": "3",
        "gtype": "gage",
        "title": "Temperatura 1",
        "label": "°C",
        "format": "{{msg.aht_temp}}",
        "min": "-20",
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "25",
        "seg2": "50",
        "diff": false,
        "className": "",
        "x": 760,
        "y": 20,
        "wires": []
    },
    {
        "id": "d3e07d6b64a66ba3",
        "type": "function",
        "z": "4ba25265ccfd5bef",
        "name": "function 1",
        "func": "// Verificar si el payload es una cadena; de ser así, intentar parsearla a JSON.\nlet original = msg.payload;\nif (typeof original === 'string') {\n    try {\n        original = JSON.parse(original);\n    } catch (e) {\n        node.error(\"No se pudo parsear el JSON: \" + e, msg);\n        return null;\n    }\n}\n\n// Extraer propiedades de nivel superior\nmsg.deviceId  = original.id;\nmsg.timestamp = original.timestamp;\nmsg.token     = original.token;\n\n// Extraer datos de sensores y también asignarlos directamente a msg para facilitar el acceso\nif (original.sensores) {\n    msg.mq135     = original.sensores.mq135;\n    msg.aht_temp  = original.sensores.aht_temp;\n    msg.aht_hum   = original.sensores.aht_hum;\n    msg.bmp_temp  = original.sensores.bmp_temp;\n    msg.bmp_pres  = original.sensores.bmp_pres;\n    msg.luz       = original.sensores.luz;\n    msg.uv        = original.sensores.uv;\n}\n\n// Extraer datos de actuadores\nif (original.actuadores) {\n    msg.pwm    = original.actuadores.pwm;\n    msg.rele1  = original.actuadores.rele1;\n    msg.rele2  = original.actuadores.rele2;\n}\n\n// Extraer datos de alarmas\nif (original.alarmas) {\n    msg.gas           = original.alarmas.gas;\n    msg.codigoAlarma  = original.alarmas.codigoAlarma;\n}\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 120,
        "wires": [
            [
                "1d55eb76f69f6745",
                "0e55fad55060e467",
                "9b82b8d5b34bb833",
                "79a8269ec9290455",
                "1b1cdb1af9b73e2f",
                "bbf13f36c41dfc37",
                "f44475d7ac900db6",
                "752d91fe7541f99f",
                "cc98cbcc604cc6af",
                "a07849dd57601235",
                "54c5c68ede4e1a7f",
                "6b21f4220362f00c",
                "e1700f78a2a3c37d",
                "be982fde5dc9cb36",
                "0bc30780c51cdc52"
            ]
        ]
    },
    {
        "id": "0e55fad55060e467",
        "type": "ui_gauge",
        "z": "4ba25265ccfd5bef",
        "name": "",
        "group": "d87413d0f61f55dc",
        "order": 5,
        "width": "4",
        "height": "3",
        "gtype": "wave",
        "title": "Humedad relativa",
        "label": "%",
        "format": "{{msg.aht_hum}}",
        "min": 0,
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 770,
        "y": 80,
        "wires": []
    },
    {
        "id": "9b82b8d5b34bb833",
        "type": "ui_gauge",
        "z": "4ba25265ccfd5bef",
        "name": "",
        "group": "d87413d0f61f55dc",
        "order": 4,
        "width": "4",
        "height": "3",
        "gtype": "gage",
        "title": "Temperatura 2",
        "label": "°C",
        "format": "{{msg.bmp_temp}}",
        "min": "-20",
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 780,
        "y": 140,
        "wires": []
    },
    {
        "id": "79a8269ec9290455",
        "type": "ui_gauge",
        "z": "4ba25265ccfd5bef",
        "name": "",
        "group": "d87413d0f61f55dc",
        "order": 6,
        "width": "4",
        "height": "3",
        "gtype": "gage",
        "title": "Presion atm",
        "label": "hpas?",
        "format": "{{msg.bmp_pres}}",
        "min": "300",
        "max": "2500",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 750,
        "y": 180,
        "wires": []
    },
    {
        "id": "1b1cdb1af9b73e2f",
        "type": "ui_gauge",
        "z": "4ba25265ccfd5bef",
        "name": "",
        "group": "d87413d0f61f55dc",
        "order": 7,
        "width": "4",
        "height": "3",
        "gtype": "gage",
        "title": "luz",
        "label": "lx",
        "format": "{{msg.luz}}",
        "min": 0,
        "max": "5000",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 690,
        "y": 240,
        "wires": []
    },
    {
        "id": "bbf13f36c41dfc37",
        "type": "ui_text",
        "z": "4ba25265ccfd5bef",
        "group": "90809e940d615866",
        "order": 0,
        "width": "0",
        "height": "0",
        "name": "",
        "label": "Gas",
        "format": "{{msg.gas}}",
        "layout": "col-center",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 490,
        "y": 240,
        "wires": []
    },
    {
        "id": "f44475d7ac900db6",
        "type": "ui_text",
        "z": "4ba25265ccfd5bef",
        "group": "90809e940d615866",
        "order": 0,
        "width": "0",
        "height": "0",
        "name": "",
        "label": "Codigo de Alarma",
        "format": "{{msg.codigoAlarma}}",
        "layout": "col-center",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 530,
        "y": 280,
        "wires": []
    },
    {
        "id": "752d91fe7541f99f",
        "type": "ui_text",
        "z": "4ba25265ccfd5bef",
        "group": "d87413d0f61f55dc",
        "order": 2,
        "width": "0",
        "height": "0",
        "name": "",
        "label": "Hora",
        "format": "{{msg.timestamp}}",
        "layout": "row-left",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 450,
        "y": 40,
        "wires": []
    },
    {
        "id": "cc98cbcc604cc6af",
        "type": "ui_text",
        "z": "4ba25265ccfd5bef",
        "group": "d87413d0f61f55dc",
        "order": 1,
        "width": "0",
        "height": "0",
        "name": "",
        "label": "ID",
        "format": "{{msg.deviceId}}",
        "layout": "row-left",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 330,
        "y": 40,
        "wires": []
    },
    {
        "id": "a07849dd57601235",
        "type": "ui_gauge",
        "z": "4ba25265ccfd5bef",
        "name": "",
        "group": "f2f70d3d4e42118c",
        "order": 5,
        "width": "4",
        "height": "3",
        "gtype": "gage",
        "title": "PWM",
        "label": "units",
        "format": "{{msg.pwm}}",
        "min": 0,
        "max": "255",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "diff": false,
        "className": "",
        "x": 330,
        "y": 260,
        "wires": []
    },
    {
        "id": "54c5c68ede4e1a7f",
        "type": "ui_text",
        "z": "4ba25265ccfd5bef",
        "group": "f2f70d3d4e42118c",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Rele1",
        "format": "{{msg.rele1}}",
        "layout": "row-center",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 330,
        "y": 300,
        "wires": []
    },
    {
        "id": "6b21f4220362f00c",
        "type": "ui_text",
        "z": "4ba25265ccfd5bef",
        "group": "f2f70d3d4e42118c",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Rele2",
        "format": "{{msg.rele2}}",
        "layout": "row-center",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#000000",
        "x": 310,
        "y": 340,
        "wires": []
    },
    {
        "id": "7d61443625ade8e9",
        "type": "mqtt out",
        "z": "4ba25265ccfd5bef",
        "name": "",
        "topic": "aqi/control",
        "qos": "0",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "mqtt_broker",
        "x": 490,
        "y": 420,
        "wires": []
    },
    {
        "id": "e1700f78a2a3c37d",
        "type": "ui_slider",
        "z": "4ba25265ccfd5bef",
        "name": "",
        "label": "pwm",
        "tooltip": "",
        "group": "f2f70d3d4e42118c",
        "order": 6,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "pwm",
        "topicType": "msg",
        "min": 0,
        "max": "255",
        "step": 1,
        "className": "",
        "x": 290,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "be982fde5dc9cb36",
        "type": "ui_switch",
        "z": "4ba25265ccfd5bef",
        "name": "",
        "label": "Rele1 act",
        "tooltip": "",
        "group": "f2f70d3d4e42118c",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "rele1",
        "topicType": "msg",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 300,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "0bc30780c51cdc52",
        "type": "ui_switch",
        "z": "4ba25265ccfd5bef",
        "name": "",
        "label": "Rele 2 act",
        "tooltip": "",
        "group": "f2f70d3d4e42118c",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "rele2",
        "topicType": "msg",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "animate": true,
        "className": "",
        "x": 300,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "a8bc9097a4f13b47",
        "type": "ui_spacer",
        "z": "4ba25265ccfd5bef",
        "name": "spacer",
        "group": "d87413d0f61f55dc",
        "order": 8,
        "width": "3",
        "height": "2"
    },
    {
        "id": "mqtt_broker",
        "type": "mqtt-broker",
        "name": "MQTT remoto",
        "broker": "172.20.0.5",
        "port": "1883",
        "tls": "",
        "clientid": "Plata_NODERED",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "3",
        "keepalive": "300",
        "cleansession": true,
        "autoUnsubscribe": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "d87413d0f61f55dc",
        "type": "ui_group",
        "name": "Sensores",
        "tab": "2bba298a5fb1fcbe",
        "order": 1,
        "disp": true,
        "width": "12",
        "collapse": false,
        "className": ""
    },
    {
        "id": "90809e940d615866",
        "type": "ui_group",
        "name": "Alarmas",
        "tab": "2bba298a5fb1fcbe",
        "order": 2,
        "disp": true,
        "width": 6,
        "collapse": false,
        "className": ""
    },
    {
        "id": "f2f70d3d4e42118c",
        "type": "ui_group",
        "name": "Actuadores",
        "tab": "2bba298a5fb1fcbe",
        "order": 3,
        "disp": true,
        "width": 6,
        "collapse": false,
        "className": ""
    },
    {
        "id": "2bba298a5fb1fcbe",
        "type": "ui_tab",
        "name": "MQTT Viewer",
        "icon": "dashboard",
        "order": 1
    }
]

```
### imagen
![image](https://github.com/user-attachments/assets/ec43cdf8-d699-4b35-8858-80a99fa33a73)
![image](https://github.com/user-attachments/assets/036ac0c3-3ad7-4707-ad76-896f5502dab3)


### Implementaciones futuras.
- Selector de dispositivo para su visualización
- Slider para controlar PWM
- Botones auto adaptables al estado actual, capaz de accionar relés
